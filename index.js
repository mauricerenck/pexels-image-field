(function(){"use strict";const x="";function g(a,e,t,r,s,l,d,m){var i=typeof a=="function"?a.options:a;e&&(i.render=e,i.staticRenderFns=t,i._compiled=!0),r&&(i.functional=!0),l&&(i._scopeId="data-v-"+l);var o;if(d?(o=function(n){n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!n&&typeof __VUE_SSR_CONTEXT__<"u"&&(n=__VUE_SSR_CONTEXT__),s&&s.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(d)},i._ssrRegister=o):s&&(o=m?function(){s.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:s),o)if(i.functional){i._injectStyles=o;var v=i.render;i.render=function(k,p){return o.call(p),v(k,p)}}else{var h=i.beforeCreate;i.beforeCreate=h?[].concat(h,o):[o]}return{exports:a,options:i}}const c={props:{label:String,value:String,downloadSize:String},data:function(){return{items:[],selectedPhoto:{id:"",photo:"",photographer:"",photographerUrl:"",downloadUrl:""},keyword:"",pexelPage:1,perPage:1,remaining:0,totalResults:0,loading:!1,downloaded:!1}},computed:{pageId(){return this.$store.getters["content/id"]()},pages(){return Math.round(this.totalResults/this.perPage,10)}},methods:{onInput(a){this.keyword=a},onSubmit(a){this.timer!==null&&clearTimeout(this.timer),!(this.keyword.length<3)&&(this.timer=setTimeout(()=>{this.search(this.keyword)},250))},showNext(){this.pexelPage*this.perPage>this.remaining||(this.pexelPage++,this.search(this.keyword))},showPrev(){this.pexelPage!==1&&(this.pexelPage--,this.search(this.keyword))},search(a){this.loading=!0,this.$api.get(`pexels/search/${a}/${this.pexelPage}/${this.downloadSize}`).then(e=>{this.page=e.page,this.perPage=e.perPage,this.remaining=e.remaining,this.totalResults=e.totalResults,this.loading=!1,this.items=e.photos.map(t=>({id:t.id,downloadUrl:t.downloadUrl,link:t.downloadUrl,photographer:t.photographer,photographerUrl:t.photographerUrl,text:`${t.photographer} <br /> ${t.width} × ${t.height}`,options:[{icon:"open",text:"View",link:t.downloadUrl,target:"_blank"},{icon:"download",text:"Download",click:()=>{this.downloadImage(t.id)}}],image:{src:t.small,width:t.width}}))})},downloadImage(a){this.downloaded=!1;const e=this.items.find(r=>r.id===a),t=e.text;e.text="Downloading…",panel.api.post("pexels/download",{imageId:a,pageId:this.pageId.split("?")[0],downloadUrl:e.downloadUrl,photographer:e.photographer,photographerUrl:e.photographerUrl}).then(()=>{this.downloaded=!1,panel.view.reload(),window.panel.notification.success("Image downloaded"),e.text=t}).catch(()=>{this.downloaded=!1,window.panel.notification.error("Image download failed"),e.text=t})}}};var u=function(){var e=this,t=e._self._c;return t("div",{staticClass:"k-pexels-field"},[t("k-field",{attrs:{label:e.label}},[t("k-input",{attrs:{theme:"field",icon:"search",type:"text",name:"textfield",value:e.value},on:{input:e.onInput,keyup:e.onSubmit}})],1),t("div",[e.loading?t("div",{staticClass:"loader"},[t("div",[t("k-icon",{attrs:{type:"loader"}})],1)]):t("div",{staticClass:"imagegrid"},[t("k-collection",{attrs:{layout:"cards",items:e.items}}),e.pages>0?t("div",{staticClass:"prev-next"},[t("button",{staticClass:"k-link k-button",on:{click:e.showPrev}},[t("k-icon",{attrs:{type:"angle-left"}})],1),t("span",[e._v(e._s(e.pexelPage)+" of "+e._s(e.pages))]),t("button",{staticClass:"k-link k-button",on:{click:e.showNext}},[t("k-icon",{attrs:{type:"angle-right"}})],1)]):e._e()],1)])],1)},f=[],_=g(c,u,f,!1,null,null,null,null);const w=_.exports;panel.plugin("mauricerenck/PexelsImageField",{fields:{pexels:w}})})();
