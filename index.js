(()=>{(function(){"use strict";var c=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"k-pexels-field"},[t("k-field",{attrs:{label:e.label}},[t("k-input",{attrs:{theme:"field",icon:"search",type:"text",name:"textfield",value:e.value},on:{input:e.onInput,keyup:e.onSubmit}})],1),t("div",[e.loading?t("div",{staticClass:"loader"},[t("k-loader")],1):e._e(),!e.loading&&e.photos.length>0?t("div",{staticClass:"imagegrid"},[t("k-grid",e._l(this.photos,function(a){return t("k-column",{key:a.id,attrs:{width:"1/6"}},[t("div",{staticClass:"k-items k-cards-items",attrs:{"data-layout":"cards","data-size":"auto"}},[t("article",{staticClass:"k-item k-cards-item",attrs:{"data-has-figure":"true","data-has-info":"true","data-has-options":"true",tabindex:"-1","data-id":"note/pexels-photo.jpg"},on:{click:[function(o){return e.onSelect(a.id,a.large,a.photographer,a.photographerUrl,a.downloadUrl)},function(o){return e.$refs.dialog.open()}]}},[t("div",{staticClass:"k-item-figure",staticStyle:{background:"var(--color-gray-800) var(--bg-pattern)"}},[t("span",{staticClass:"k-image k-item-image",attrs:{"data-ratio":"3/2","data-cover":"true"}},[t("span",{staticStyle:{"padding-bottom":"66.67%"}},[t("img",{attrs:{alt:"pexels photo",src:a.small}})])])]),t("header",{staticClass:"k-item-content"},[t("h3",{staticClass:"k-item-title"},[t("span",[e._v(" "+e._s(a.photographer)+" ")])]),t("p",{staticClass:"k-item-info"},[e._v(e._s(a.width)+" \xD7 "+e._s(a.height))])])])])])}),1),t("div",{staticClass:"prev-next"},[t("button",{staticClass:"k-link k-button",on:{click:e.showPrev}},[t("k-icon",{attrs:{type:"angle-left"}})],1),t("span",[e._v(e._s(e.pexelPage)+" of "+e._s(e.pages))]),t("button",{staticClass:"k-link k-button",on:{click:e.showNext}},[t("k-icon",{attrs:{type:"angle-right"}})],1)])],1):e._e()]),t("div",[t("k-dialog",{ref:"dialog",attrs:{submitButton:"Download",theme:"positive",icon:"download",size:"large"},on:{submit:e.downloadImage}},[e._v(" A photo by "),t("strong",[e._v(e._s(e.selectedPhoto.photographer))]),t("k-image",{attrs:{src:e.selectedPhoto.photo}}),this.downloading?t("k-info-field",{attrs:{text:"Downloading file"}}):e._e(),this.downloaded?t("k-info-field",{attrs:{theme:"positive",text:"Downloaded file, refresh page to see it"}}):e._e()],1)],1)],1)},u=[],y="";function f(e,i,t,a,o,d,h,w){var s=typeof e=="function"?e.options:e;i&&(s.render=i,s.staticRenderFns=t,s._compiled=!0),a&&(s.functional=!0),d&&(s._scopeId="data-v-"+d);var r;if(h?(r=function(n){n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!n&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(n=__VUE_SSR_CONTEXT__),o&&o.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(h)},s._ssrRegister=r):o&&(r=w?function(){o.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:o),r)if(s.functional){s._injectStyles=r;var P=s.render;s.render=function(C,g){return r.call(g),P(C,g)}}else{var p=s.beforeCreate;s.beforeCreate=p?[].concat(p,r):[r]}return{exports:e,options:s}}const _={props:{label:String,value:String,apiKey:String},data:function(){return{photos:[],selectedPhoto:{id:"",photo:"",photographer:"",photographerUrl:"",downloadUrl:""},keyword:"",pexelPage:1,remaining:0,totalResults:0,loading:!1,timer:null,downloading:!1,downloaded:!1}},computed:{pageId(){return this.$store.getters["content/id"]()},pages(){return Math.round(this.totalResults/this.photos.length,10)}},methods:{onInput(e){this.keyword=e},onSubmit(e){this.timer!==null&&clearTimeout(this.timer),!(this.keyword.length<3)&&(this.timer=setTimeout(()=>{this.search(this.keyword)},250))},onSelect(e,i,t,a,o){this.selectedPhoto={id:e,photo:i,photographer:t,photographerUrl:a,downloadUrl:o}},showNext(){this.pexelPage*this.perPage>this.remaining||(this.pexelPage++,this.search(this.keyword))},showPrev(){this.pexelPage!==1&&(this.pexelPage--,this.search(this.keyword))},search(e){this.loading=!0,this.$api.get(`pexels/search/${e}/${this.pexelPage}`).then(i=>{this.photos=i.photos,this.page=i.page,this.perPage=i.perPage,this.remaining=i.remaining,this.totalResults=i.totalResults,this.loading=!1})},downloadImage(e){this.downloading=!0,this.downloaded=!1,this.$api.post("pexels/download",{downloadUrl:this.selectedPhoto.downloadUrl,pageId:this.pageId.split("?")[0],imageId:this.selectedPhoto.id,photographer:this.selectedPhoto.photographer,photographerUrl:this.selectedPhoto.photographerUrl}).then(()=>{this.downloading=!1,this.downloaded=!0,setTimeout(()=>{this.$refs.dialog.close(),this.downloaded=!1},2e3)})}}},l={};var m=f(_,c,u,!1,v,null,null,null);function v(e){for(let i in l)this[i]=l[i]}var k=function(){return m.exports}();panel.plugin("mauricerenck/PexelsImageField",{fields:{pexels:k}})})();})();
